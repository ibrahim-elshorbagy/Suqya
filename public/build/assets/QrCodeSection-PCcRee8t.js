import{b as j,r as i,a as x,j as e}from"./app-0kQzlsIH.js";import{A as s}from"./ActionButton-Db6MceOV.js";import{u as k}from"./useTrans-Dl6FgQZB.js";function q({tenant:a,className:g=""}){const{t:o}=k(),{flash:c}=j().props,[t,l]=i.useState(!1),[d,u]=i.useState(Date.now());i.useEffect(()=>{a?.qr_code&&u(Date.now())},[a?.qr_code]),i.useEffect(()=>{c?.status==="success"&&c?.title?.includes("QR")&&(u(Date.now()),setTimeout(()=>{x.reload({only:["tenant"]})},500))},[c]);const m=()=>{t||(l(!0),x.post(route("tenant.generate-qr"),{},{preserveState:!0,preserveScroll:!0,onSuccess:r=>{l(!1),u(Date.now()),x.reload({only:["tenant"]})},onError:r=>{l(!1)},onFinish:()=>{l(!1)}}))},f=async()=>{if(a?.qr_code)try{const r=new Image;r.crossOrigin="anonymous",r.onload=async()=>{const n=document.createElement("canvas"),h=n.getContext("2d");n.width=r.width,n.height=r.height,h.drawImage(r,0,0),n.toBlob(async w=>{try{await navigator.clipboard.write([new ClipboardItem({"image/png":w})]),alert(o("qr_code_copied")||"QR Code copied to clipboard!")}catch(y){console.error("Failed to copy QR code:",y),alert(o("copy_failed")||"Failed to copy QR code to clipboard")}},"image/png")},r.onerror=()=>{console.error("Failed to load QR code image"),alert(o("copy_failed")||"Failed to copy QR code to clipboard")},r.src=`/storage/${a.qr_code}?v=${d}`}catch(r){console.error("Copy QR code error:",r),alert(o("copy_failed")||"Failed to copy QR code to clipboard")}},p=()=>{if(a?.qr_code){const r=document.createElement("a");r.href=`/storage/${a.qr_code}?download=1`,r.download=`${a.slug}-qr-code.${a.qr_code.split(".").pop()}`,document.body.appendChild(r),r.click(),document.body.removeChild(r)}},b=()=>{a?.qr_code&&window.open(`/storage/${a.qr_code}`,"_blank")};return e.jsx("section",{className:g,children:a?.slug?e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-800 rounded-lg p-6 border border-neutral-200 dark:border-neutral-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100 mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-qrcode text-blue-500"}),o("qr_code")]}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-3",children:o("qr_code_description")}),e.jsxs("div",{className:"text-sm text-neutral-700 dark:text-neutral-300 ",children:[e.jsxs("strong",{children:[o("website_url"),":"]}),e.jsx("br",{}),e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400 break-all flex gap-2",children:[e.jsxs("span",{children:[window.location.origin,"/",a.slug]}),e.jsx("a",{href:`${window.location.origin}/${a.slug}`,target:"_blank",rel:"noopener noreferrer",className:"ml-2 inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300","aria-label":"Open tenant link in new tab",children:e.jsx("i",{className:"fa fa-external-link","aria-hidden":"true"})})]})]})]}),e.jsx("div",{className:"flex flex-col items-center gap-3",children:a?.qr_code?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-2 rounded-lg border-2 border-neutral-200 dark:border-neutral-700 shadow-sm",children:e.jsx("img",{src:`/storage/${a.qr_code}?v=${d}`,alt:"QR Code",className:"w-24 h-24 lg:w-32 lg:h-32",onLoad:()=>console.log("QR image loaded successfully"),onError:r=>{console.error("QR code failed to load:",r),console.log("Image src:",r.target.src)}},d)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(s,{onClick:p,variant:"success",icon:"fa-download",size:"sm",as:"button",type:"button",children:o("download")}),e.jsx(s,{onClick:f,variant:"info",icon:"fa-copy",size:"sm",as:"button",type:"button",children:o("copy")}),e.jsx(s,{onClick:b,variant:"primary",icon:"fa-external-link-alt",size:"sm",as:"button",type:"button",children:o("view")}),e.jsx(s,{onClick:m,variant:"info",icon:t?"fa-spinner fa-spin":"fa-refresh",size:"sm",as:"button",type:"button",disabled:t,children:t?o("generating")||"Generating...":o("regenerate_qr")||"Regenerate"})]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 lg:w-32 lg:h-32 border-2 border-dashed border-neutral-300 dark:border-neutral-600 rounded-lg flex items-center justify-center bg-neutral-100 dark:bg-neutral-700",children:t?e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-blue-500 text-3xl"}):e.jsx("i",{className:"fa-solid fa-qrcode text-neutral-400 dark:text-neutral-500 text-3xl"})}),e.jsx(s,{onClick:m,variant:"success",icon:t?"fa-spinner fa-spin":"fa-qrcode",size:"sm",as:"button",type:"button",disabled:t||!a.slug,children:t?o("generating")||"Generating...":o("generate_qr")||"Generate QR"})]})})]})}):e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-exclamation-triangle text-yellow-600 dark:text-yellow-400"}),e.jsx("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:o("save_basic_info_first")})]})})})}export{q as default};
