import{b as F,r as i,u as $,a as x,j as e}from"./app-BBZqCkcl.js";import{I as y,a as f}from"./InputLabel-HD_7jxvh.js";import{T as j}from"./TextInput-D29DJAKt.js";import{S as E}from"./SelectInput-h5floCRN.js";import{P as z}from"./PrimaryButton-DYWPge3E.js";import{A as o}from"./ActionButton-Ctok6Vou.js";import{u as D}from"./useTrans-Dl6FgQZB.js";import{z as T}from"./transition-BSrBxBGh.js";function H({tenant:r,currencies:v,className:_=""}){const{t:s}=D(),{flash:d}=F().props,[t,l]=i.useState(!1),[u,m]=i.useState(Date.now()),{data:n,setData:p,patch:w,processing:h,errors:g,recentlySuccessful:N}=$({name:r?.name||"",slug:r?.slug||"",currency_id:r?.currency_id||""});i.useEffect(()=>{r?.qr_code&&m(Date.now())},[r?.qr_code]),i.useEffect(()=>{d?.status==="success"&&d?.title?.includes("QR")&&(m(Date.now()),setTimeout(()=>{x.reload({only:["tenant"]})},500))},[d]);const k=a=>{a.preventDefault(),w(route("tenant.basic-info.update"),n,{preserveScroll:!0})},b=()=>{t||(l(!0),x.post(route("tenant.generate-qr"),{},{preserveState:!0,preserveScroll:!0,onSuccess:a=>{l(!1),m(Date.now()),x.reload({only:["tenant"]})},onError:a=>{l(!1)},onFinish:()=>{l(!1)}}))},q=async()=>{if(r?.qr_code)try{const a=new Image;a.crossOrigin="anonymous",a.onload=async()=>{const c=document.createElement("canvas"),S=c.getContext("2d");c.width=a.width,c.height=a.height,S.drawImage(a,0,0),c.toBlob(async I=>{try{await navigator.clipboard.write([new ClipboardItem({"image/png":I})]),alert(s("qr_code_copied")||"QR Code copied to clipboard!")}catch(R){console.error("Failed to copy QR code:",R),alert(s("copy_failed")||"Failed to copy QR code to clipboard")}},"image/png")},a.onerror=()=>{console.error("Failed to load QR code image"),alert(s("copy_failed")||"Failed to copy QR code to clipboard")},a.src=`/storage/${r.qr_code}?v=${u}`}catch(a){console.error("Copy QR code error:",a),alert(s("copy_failed")||"Failed to copy QR code to clipboard")}},C=()=>{if(r?.qr_code){const a=document.createElement("a");a.href=`/storage/${r.qr_code}?download=1`,a.download=`${r.slug}-qr-code.${r.qr_code.split(".").pop()}`,document.body.appendChild(a),a.click(),document.body.removeChild(a)}},Q=()=>{r?.qr_code&&window.open(`/storage/${r.qr_code}`,"_blank")};return e.jsxs("section",{className:_,children:[e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-4",children:s("update_basic_info_description")}),e.jsxs("form",{onSubmit:k,className:"space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"company_name",value:s("company_name")}),e.jsx(j,{id:"company_name",className:"mt-1 block w-full",value:n.name,onChange:a=>p("name",a.target.value),required:!0,isFocused:!0,autoComplete:"organization",icon:"fa-building"}),e.jsx(f,{className:"mt-2",message:g.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"company_slug",value:s("company_slug")}),e.jsx(j,{id:"company_slug",className:"mt-1 block w-full",value:n.slug,onChange:a=>p("slug",a.target.value),required:!0,autoComplete:"url",icon:"fa-link",placeholder:"company-name-slug"}),e.jsx(f,{className:"mt-2",message:g.slug}),e.jsx("p",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:s("slug_condition")})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{name:"currency_id",value:n.currency_id,onChange:a=>p("currency_id",a.target.value),options:[{value:"",label:s("select_currency")||"Select Currency"},...v.map(a=>({value:a.id,label:`${a.name} (${a.code})`}))],label:s("currency")||"Currency",icon:"fa-money-bill"}),e.jsx(f,{className:"mt-2",message:g.currency_id})]}),e.jsxs("div",{className:"pt-4 flex items-center gap-4",children:[e.jsx(z,{type:"submit",disabled:h,icon:"fa-floppy-disk",rounded:"rounded-lg",withShadow:!1,children:h?s("saving")||"Saving...":s("save_changes")||"Save Changes"}),e.jsx(T,{show:N,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-check"})," ",s("saved_successfully")||"Saved successfully!"]})})]}),r?.slug&&e.jsx("div",{className:"bg-neutral-50 dark:bg-neutral-800 rounded-lg p-6 border border-neutral-200 dark:border-neutral-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100 mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-qrcode text-blue-500"}),s("qr_code")]}),e.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-3",children:s("qr_code_description")}),e.jsxs("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:[e.jsxs("strong",{children:[s("website_url"),":"]}),e.jsxs("span",{className:"ml-2 text-blue-600 dark:text-blue-400 break-all",children:[window.location.origin,"/",r.slug]})]})]}),e.jsx("div",{className:"flex flex-col items-center gap-3",children:r?.qr_code?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-2 rounded-lg border-2 border-neutral-200 dark:border-neutral-700 shadow-sm",children:e.jsx("img",{src:`/storage/${r.qr_code}?v=${u}`,alt:"QR Code",className:"w-24 h-24 lg:w-32 lg:h-32",onLoad:()=>console.log("QR image loaded successfully"),onError:a=>{console.error("QR code failed to load:",a),console.log("Image src:",a.target.src)}},u)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[e.jsx(o,{onClick:C,variant:"success",icon:"fa-download",size:"sm",as:"button",type:"button",children:s("download")}),e.jsx(o,{onClick:q,variant:"info",icon:"fa-copy",size:"sm",as:"button",type:"button",children:s("copy")}),e.jsx(o,{onClick:Q,variant:"primary",icon:"fa-external-link-alt",size:"sm",as:"button",type:"button",children:s("view")}),e.jsx(o,{onClick:b,variant:"info",icon:t?"fa-spinner fa-spin":"fa-refresh",size:"sm",as:"button",type:"button",disabled:t,children:t?s("generating")||"Generating...":s("regenerate_qr")||"Regenerate"})]})]}):e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"w-24 h-24 lg:w-32 lg:h-32 border-2 border-dashed border-neutral-300 dark:border-neutral-600 rounded-lg flex items-center justify-center bg-neutral-100 dark:bg-neutral-700",children:t?e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-blue-500 text-3xl"}):e.jsx("i",{className:"fa-solid fa-qrcode text-neutral-400 dark:text-neutral-500 text-3xl"})}),e.jsx(o,{onClick:b,variant:"success",icon:t?"fa-spinner fa-spin":"fa-qrcode",size:"sm",as:"button",type:"button",disabled:t||!r.slug,children:t?s("generating")||"Generating...":s("generate_qr")||"Generate QR"})]})})]})})]})]})}export{H as default};
